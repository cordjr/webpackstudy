{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","Negociacao","NegociacoesView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","getExceptionMessage","debounce","controller","bindEvent","NegociacaoController","constructor","_inputData","_inputQuantidade","_inputValor","Object","assign","_negociacoes","_mensagem","_init","dao","negociacoes","listaTodos","forEach","adiciona","negociacao","err","texto","event","_criaNegociacao","_limpaFormulario","value","focus","paraData","parseInt","parseFloat","importaNegociacoes","NegociacaoService","System","import","service","obtemNegociacoesDoPeriodo","console","log","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente","apaga","apagaTodos","esvazia"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,WAAT,EAAuBC,UAAvB,QAAyC,oBAAzC;AACA,SAASC,eAAT,EAA0BC,YAA1B,EAAwCC,QAAxC,EAAkDC,aAAlD,QAAuE,gBAAvE;AACA,SAASC,gBAAT,EAA2BC,IAA3B,EAAiCC,mBAAjC,EAAsDC,QAAtD,EAAgEC,UAAhE,EAA4EC,SAA5E,QAA6F,kBAA7F;;AAGA,WAAaC,oBAAb,WADCF,WAAW,OAAX,EAAoB,aAApB,EAAmC,QAAnC,CACD,UAkCKC,UAAU,QAAV,EAAoB,OAApB,CAlCL,UAmCKF,UAnCL,UAmEKE,UAAU,OAAV,EAAmB,gBAAnB,CAnEL,UAoEKF,UApEL,UAwFKE,UAAU,OAAV,EAAmB,cAAnB,CAxFL,2BAAO,MAAMC,oBAAN,CAA2B;;AAE9BC,gBAAYC,UAAZ,EAAwBC,gBAAxB,EAA0CC,WAA1C,EAAuD;;AAEnDC,eAAOC,MAAP,CAAc,IAAd,EAAoB,EAAEJ,UAAF,EAAcC,gBAAd,EAAgCC,WAAhC,EAApB;;AAEA,aAAKG,YAAL,GAAoB,IAAIZ,IAAJ,CAChB,IAAIP,WAAJ,EADgB,EAEhB,IAAIE,eAAJ,CAAoB,cAApB,CAFgB,EAGhB,UAHgB,EAGJ,SAHI,CAApB;;AAMA,aAAKkB,SAAL,GAAiB,IAAIb,IAAJ,CACb,IAAIH,QAAJ,EADa,EAEb,IAAID,YAAJ,CAAiB,eAAjB,CAFa,EAGb,OAHa,CAAjB;;AAQA,aAAKkB,KAAL;AACH;;AAEKA,SAAN,GAAc;AAAA;;AAAA;;AAEV,gBAAI;AACA,sBAAMC,MAAM,MAAMhB,kBAAlB;AACA,sBAAMiB,cAAc,MAAMD,IAAIE,UAAJ,EAA1B;AACAD,4BAAYE,OAAZ,CAAoB;AAAA,2BAAc,MAAKN,YAAL,CAAkBO,QAAlB,CAA2BC,UAA3B,CAAd;AAAA,iBAApB;AACH,aAJD,CAIE,OAAOC,GAAP,EAAY;AACV,sBAAKR,SAAL,CAAeS,KAAf,GAAuBrB,oBAAoBoB,GAApB,CAAvB;AACH;AARS;AASb;;AAIKF,YAAN,CAAeI,KAAf,EAAsB;AAAA;;AAAA;;AAElB,gBAAI;AACA,sBAAMH,aAAa,OAAKI,eAAL,EAAnB;AACA,sBAAMT,MAAM,MAAMhB,kBAAlB;AACA,sBAAMgB,IAAII,QAAJ,CAAaC,UAAb,CAAN;AACA,uBAAKR,YAAL,CAAkBO,QAAlB,CAA2BC,UAA3B;AACA,uBAAKP,SAAL,CAAeS,KAAf,GAAuB,mCAAvB;AACA,uBAAKG,gBAAL;AACH,aAPD,CAOE,OAAOJ,GAAP,EAAY;AACV,uBAAKR,SAAL,CAAeS,KAAf,GAAuBrB,oBAAoBoB,GAApB,CAAvB;AACH;AAXiB;AAYrB;;AAEDI,uBAAmB;;AAEf,aAAKlB,UAAL,CAAgBmB,KAAhB,GAAwB,EAAxB;AACA,aAAKlB,gBAAL,CAAsBkB,KAAtB,GAA8B,CAA9B;AACA,aAAKjB,WAAL,CAAiBiB,KAAjB,GAAyB,GAAzB;AACA,aAAKnB,UAAL,CAAgBoB,KAAhB;AACH;;AAEDH,sBAAkB;;AAEd,eAAO,IAAI9B,UAAJ,CACHI,cAAc8B,QAAd,CAAuB,KAAKrB,UAAL,CAAgBmB,KAAvC,CADG,EAEHG,SAAS,KAAKrB,gBAAL,CAAsBkB,KAA/B,CAFG,EAGHI,WAAW,KAAKrB,WAAL,CAAiBiB,KAA5B,CAHG,CAAP;AAKH;;AAIKK,sBAAN,GAA2B;AAAA;;AAAA;;AAEvB,gBAAI;AACA,sBAAM,EAAEC,iBAAF,KAAwB,MAAMC,OAAOC,MAAP,CAAc,wCAAd,CAApC;AACA,sBAAMC,UAAU,IAAIH,iBAAJ,EAAhB;AACA,sBAAMhB,cAAc,MAAMmB,QAAQC,yBAAR,EAA1B;AACAC,wBAAQC,GAAR,CAAYtB,WAAZ;AACAA,4BAAYuB,MAAZ,CAAmB;AAAA,2BAEf,CAAC,OAAK3B,YAAL,CAAkB4B,SAAlB,GAA8BC,IAA9B,CAAmC;AAAA,+BAChCC,eAAeC,MAAf,CAAsBC,mBAAtB,CADgC;AAAA,qBAAnC,CAFc;AAAA,iBAAnB,EAIK1B,OAJL,CAIa;AAAA,2BAAc,OAAKN,YAAL,CAAkBO,QAAlB,CAA2BC,UAA3B,CAAd;AAAA,iBAJb;;AAMA,uBAAKP,SAAL,CAAeS,KAAf,GAAuB,+CAAvB;AACH,aAZD,CAYE,OAAOD,GAAP,EAAY;AACV,uBAAKR,SAAL,CAAeS,KAAf,GAAuBrB,oBAAoBoB,GAApB,CAAvB;AACH;AAhBsB;AAiB1B;;AAGKwB,SAAN,GAAc;AAAA;;AAAA;;AAEV,gBAAI;AACA,sBAAM9B,MAAM,MAAMhB,kBAAlB;AACA,sBAAMgB,IAAI+B,UAAJ,EAAN;AACA,uBAAKlC,YAAL,CAAkBmC,OAAlB;AACA,uBAAKlC,SAAL,CAAeS,KAAf,GAAuB,kCAAvB;AACH,aALD,CAKE,OAAOD,GAAP,EAAY;AACV,uBAAKR,SAAL,CAAeS,KAAf,GAAuBrB,oBAAoBoB,GAApB,CAAvB;AACH;AATS;AAUb;AAnG6B,CAAlC","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes,  Negociacao } from '../domain/index.js';\nimport { NegociacoesView, MensagemView, Mensagem, DateConverter } from '../ui/index.js';\nimport { getNegociacaoDao, Bind, getExceptionMessage, debounce, controller, bindEvent } from '../util/index.js';\n\n@controller('#data', '#quantidade', '#valor')\nexport class NegociacaoController {\n\n    constructor(_inputData, _inputQuantidade, _inputValor) {\n\n        Object.assign(this, { _inputData, _inputQuantidade, _inputValor })\n        \n        this._negociacoes = new Bind(\n            new Negociacoes(),\n            new NegociacoesView('#negociacoes'),\n            'adiciona', 'esvazia'\n        );\n\n        this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView('#mensagemView'),\n            'texto'\n        );\n\n        \n\n        this._init();\n    }\n\n    async _init() {\n\n        try {\n            const dao = await getNegociacaoDao();\n            const negociacoes = await dao.listaTodos();\n            negociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao));\n        } catch (err) {\n            this._mensagem.texto = getExceptionMessage(err);\n        }\n    }\n\n    @bindEvent('submit', '.form')\n    @debounce()\n    async adiciona(event) {\n\n        try {\n            const negociacao = this._criaNegociacao();\n            const dao = await getNegociacaoDao();\n            await dao.adiciona(negociacao);\n            this._negociacoes.adiciona(negociacao);\n            this._mensagem.texto = 'Negociação adicionada com sucesso';\n            this._limpaFormulario();\n        } catch (err) {\n            this._mensagem.texto = getExceptionMessage(err);\n        }\n    }\n\n    _limpaFormulario() {\n\n        this._inputData.value = '';\n        this._inputQuantidade.value = 1;\n        this._inputValor.value = 0.0\n        this._inputData.focus();\n    }\n\n    _criaNegociacao() {\n\n        return new Negociacao(\n            DateConverter.paraData(this._inputData.value),\n            parseInt(this._inputQuantidade.value),\n            parseFloat(this._inputValor.value)\n        );\n    }\n\n    @bindEvent('click', '#botao-importa')\n    @debounce()\n    async importaNegociacoes() {\n\n        try {\n            const { NegociacaoService } = await System.import('../domain/negociacao/NegociacaoService');\n            const service = new NegociacaoService();\n            const negociacoes = await service.obtemNegociacoesDoPeriodo();\n            console.log(negociacoes);\n            negociacoes.filter(novaNegociacao =>\n\n                !this._negociacoes.paraArray().some(negociacaoExistente =>\n                    novaNegociacao.equals(negociacaoExistente)))\n                .forEach(negociacao => this._negociacoes.adiciona(negociacao));\n\n            this._mensagem.texto = 'Negociações do período importadas com sucesso';\n        } catch (err) {\n            this._mensagem.texto = getExceptionMessage(err);\n        }\n    }\n\n    @bindEvent('click', '#botao-apaga')\n    async apaga() {\n\n        try {\n            const dao = await getNegociacaoDao();\n            await dao.apagaTodos();\n            this._negociacoes.esvazia();\n            this._mensagem.texto = 'Negociações apagadas com sucesso';\n        } catch (err) {\n            this._mensagem.texto = getExceptionMessage(err);\n        }\n    }\n}"]}